<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:lang="clr-namespace:TableCloth3.Launcher.Languages"
		xmlns:vm="clr-namespace:TableCloth3.Launcher.ViewModels"
		xmlns:controls="clr-namespace:TableCloth3.Shared.Controls"
		xmlns:ui="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls"
		mc:Ignorable="d"
		Width="520"
		MinWidth="520"
		MaxWidth="600"
		CanResize="False"
		SizeToContent="Height"
		x:Class="TableCloth3.Launcher.Windows.LauncherMainWindow"
		x:DataType="vm:LauncherMainWindowViewModel"
		Title="{x:Static lang:LauncherStrings.LauncherMainWindowTitle}"
		WindowStartupLocation="CenterScreen"
		Icon="avares://TableCloth3/Assets/Images/TableCloth.png">
	<Design.DataContext>
		<vm:LauncherMainWindowViewModel />
	</Design.DataContext>
	<Interaction.Behaviors>
		<RoutedEventTriggerBehavior RoutedEvent="{x:Static ui:Control.LoadedEvent}">
			<InvokeCommandAction Command="{Binding LoadedCommand}" />
		</RoutedEventTriggerBehavior>
	</Interaction.Behaviors>
	
	<Window.Styles>
		<Style Selector="CheckBox">
			<Setter Property="Margin" Value="0,8" />
			<Setter Property="FontSize" Value="14" />
		</Style>
		<Style Selector="CheckBox ContentPresenter">
			<Setter Property="RecognizesAccessKey" Value="True" />
		</Style>
		<Style Selector="Button">
			<Setter Property="Padding" Value="16,8" />
			<Setter Property="MinHeight" Value="32" />
			<Setter Property="FontSize" Value="13" />
		</Style>
		<Style Selector="Button.primary">
			<Setter Property="Background" Value="{DynamicResource AccentButtonBackground}" />
			<Setter Property="Foreground" Value="{DynamicResource AccentButtonForeground}" />
			<Setter Property="BorderBrush" Value="{DynamicResource AccentButtonBorderBrush}" />
		</Style>
		<Style Selector="Button.primary:pointerover">
			<Setter Property="Background" Value="{DynamicResource AccentButtonBackgroundPointerOver}" />
		</Style>
		<Style Selector="Button.secondary">
			<Setter Property="Background" Value="{DynamicResource ButtonBackground}" />
			<Setter Property="BorderBrush" Value="{DynamicResource ButtonBorderBrush}" />
		</Style>
	</Window.Styles>
	
	<Grid>
		<DockPanel Margin="24">
			<!-- Action Buttons -->
			<Grid Margin="0,24,0,0" DockPanel.Dock="Bottom">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				
				<Button Grid.Column="0" 
				        Content="{x:Static lang:LauncherStrings.AboutApp}" 
				        Command="{Binding AboutButtonCommand}"
				        Classes="secondary" />
				
				<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12">
					<Button Content="{x:Static lang:LauncherStrings.LaunchSandbox}" 
					        Command="{Binding LaunchButtonCommand}"
					        Classes="primary"
					        MinWidth="120" />
					<Button Content="{x:Static lang:LauncherStrings.CloseApp}" 
					        Command="{Binding CloseButtonCommand}"
					        Classes="secondary" />
				</StackPanel>
			</Grid>
			
			<!-- MCP Server Status Section -->
			<Border DockPanel.Dock="Bottom" 
			        Margin="0,16,0,16" 
			        Padding="16" 
			        Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
			        BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
			        BorderThickness="1"
			        CornerRadius="8"
			        BoxShadow="0 1 3 0 #0F000000">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					
					<!-- Header -->
					<TextBlock Grid.Row="0" 
					          Text="{x:Static lang:LauncherStrings.McpServerConnectionStatus}"
					          FontSize="14"
					          FontWeight="SemiBold"
					          Margin="0,0,0,8"
					          Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
					
					<!-- Status Content -->
					<Grid Grid.Row="1">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						
						<!-- Status Indicator -->
						<Border Grid.Column="0"
						        Width="16" Height="16" 
						        VerticalAlignment="Center"
						        CornerRadius="8"
						        Margin="0,0,12,0">
							<Border.Background>
								<SolidColorBrush>
									<SolidColorBrush.Color>
										<MultiBinding Converter="{StaticResource McpServerStatusToColorConverter}">
											<Binding Path="IsMcpServerHealthy" />
											<Binding Path="McpServerStatusChecking" />
										</MultiBinding>
									</SolidColorBrush.Color>
								</SolidColorBrush>
							</Border.Background>
						</Border>
						
						<!-- Status Text -->
						<TextBlock Grid.Column="1"
						          Text="{Binding McpServerStatusText}" 
						          VerticalAlignment="Center"
						          FontSize="13"
						          TextWrapping="Wrap"
						          Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
						
						<!-- Loading Indicator -->
						<controls:ProgressRing Grid.Column="2"
						                      Width="18" Height="18" 
						                      VerticalAlignment="Center"
						                      Margin="8,0"
						                      IsVisible="{Binding McpServerStatusChecking}" />
						
						<!-- Refresh Button -->
						<Button Grid.Column="3"
						        Content="{x:Static lang:LauncherStrings.RefreshButton}" 
						        Command="{Binding CheckMcpServerStatusCommand}"
						        IsEnabled="{Binding McpServerStatusChecking, Converter={x:Static BoolConverters.Not}}"
						        VerticalAlignment="Center"
						        Padding="12,4"
						        FontSize="12"
						        Classes="secondary"
						        ToolTip.Tip="{x:Static lang:LauncherStrings.RefreshMcpServerStatusTooltip}" />
					</Grid>
					
					<!-- MCP Config Copy Section -->
					<Border Grid.Row="2" 
					        Margin="0,12,0,0"
					        Padding="16"
					        BorderBrush="{DynamicResource AccentControlElevationBorderBrush}"
					        BorderThickness="1"
					        CornerRadius="6"
					        IsVisible="{Binding IsMcpServerHealthy}">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto" />
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="Auto" />
							</Grid.ColumnDefinitions>
							
							<!-- Success Icon -->
							<Border Grid.Column="0"
							        Width="20" Height="20"
							        Background="{DynamicResource SystemFillColorSuccessBrush}"
							        CornerRadius="10"
							        VerticalAlignment="Center"
							        Margin="0,0,12,0">
								<Path Width="12" Height="12"
								      Fill="White"
								      Data="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"
								      Stretch="Uniform"
								      HorizontalAlignment="Center"
								      VerticalAlignment="Center" />
							</Border>
							
							<StackPanel Grid.Column="1" 
							           VerticalAlignment="Center"
							           Spacing="2">
								<TextBlock Text="{x:Static lang:LauncherStrings.McpServerConnectedSuccessfully}"
								          FontSize="13"
								          FontWeight="SemiBold"
								          Foreground="{DynamicResource SystemFillColorSuccessBrush}" />
								<TextBlock Text="{x:Static lang:LauncherStrings.CopyClaudeDesktopConfig}"
								          FontSize="11"
								          Foreground="{DynamicResource TextFillColorSecondaryBrush}"
								          TextWrapping="Wrap" />
							</StackPanel>
							
							<Button Grid.Column="2"
							        Content="{x:Static lang:LauncherStrings.CopyClaudeSettings}"
							        Command="{Binding CopyMcpConfigCommand}"
							        VerticalAlignment="Center"
							        Padding="16,8"
							        FontSize="12"
							        FontWeight="Medium"
							        Classes="primary"
							        ToolTip.Tip="{x:Static lang:LauncherStrings.CopyClaudeSettingsTooltip}">
								<Button.Template>
									<ControlTemplate>
										<Border Background="{TemplateBinding Background}"
										        BorderBrush="{TemplateBinding BorderBrush}"
										        BorderThickness="{TemplateBinding BorderThickness}"
										        CornerRadius="6"
										        Padding="{TemplateBinding Padding}">
											<StackPanel Orientation="Horizontal" 
											           Spacing="8"
											           VerticalAlignment="Center">
												<!-- Copy Icon -->
												<Path Width="14" Height="14"
												      Fill="{TemplateBinding Foreground}"
												      Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"
												      Stretch="Uniform" />
												<ContentPresenter />
											</StackPanel>
										</Border>
									</ControlTemplate>
								</Button.Template>
							</Button>
						</Grid>
					</Border>
				</Grid>
			</Border>
			
			<!-- Main Configuration Section -->
			<Border Padding="0" CornerRadius="8">
				<StackPanel Spacing="4">
					<TextBlock Text="{x:Static lang:LauncherStrings.SandboxSettings}"
					          FontSize="16"
					          FontWeight="SemiBold"
					          Margin="0,0,0,16"
					          Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
					
					<!-- Hardware Access -->
					<Border Padding="16" 
					        Background="{DynamicResource SubtleFillColorTransparentBrush}"
					        BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
					        BorderThickness="0,0,0,1"
					        Margin="0,0,0,8">
						<StackPanel Spacing="4">
							<TextBlock Text="{x:Static lang:LauncherStrings.HardwareAccess}"
							          FontSize="13"
							          FontWeight="Medium"
							          Margin="0,0,0,8"
							          Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
							<CheckBox Content="{x:Static lang:LauncherStrings.UseMicrophone}" 
							         IsChecked="{Binding UseMicrophone}" />
							<CheckBox Content="{x:Static lang:LauncherStrings.UseWebCamera}" 
							         IsChecked="{Binding UseWebCamera}" />
							<CheckBox Content="{x:Static lang:LauncherStrings.SharePrinters}" 
							         IsChecked="{Binding SharePrinters}" />
						</StackPanel>
					</Border>
					
					<!-- Folder Access -->
					<Border Padding="16" 
					        Background="{DynamicResource SubtleFillColorTransparentBrush}">
						<StackPanel Spacing="4">
							<TextBlock Text="{x:Static lang:LauncherStrings.FolderAccess}"
							          FontSize="13"
							          FontWeight="Medium"
							          Margin="0,0,0,8"
							          Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
							<CheckBox Content="{x:Static lang:LauncherStrings.MountNpkiFolders}" 
							         IsChecked="{Binding MountNpkiFolders}" />
							<Grid>
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="Auto" />
									<ColumnDefinition Width="*" />
								</Grid.ColumnDefinitions>
								<CheckBox Grid.Column="0"
								         Content="{x:Static lang:LauncherStrings.MountSpecificFolders}" 
								         IsChecked="{Binding MountSpecificFolders}" />
								<Button Grid.Column="1"
								        Margin="16,0,0,0" 
								        Command="{Binding ManageFolderButtonCommand}" 
								        Content="{x:Static lang:LauncherStrings.ManageFolders}" 
								        IsEnabled="{Binding MountSpecificFolders}"
								        Classes="secondary"
								        HorizontalAlignment="Left"
								        Padding="12,4"
								        FontSize="12" />
							</Grid>
						</StackPanel>
					</Border>
				</StackPanel>
			</Border>
		</DockPanel>
		
		<!-- Loading Overlay -->
		<Grid Background="#80000000" 
		      IsVisible="{Binding Loading}"
		      ZIndex="100">
			<Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
			        BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
			        BorderThickness="1"
			        CornerRadius="8"
			        Padding="24"
			        HorizontalAlignment="Center"
			        VerticalAlignment="Center"
			        BoxShadow="0 4 12 0 #20000000">
				<StackPanel Orientation="Horizontal" Spacing="16">
					<controls:ProgressRing Width="24" Height="24" />
					<TextBlock Text="{x:Static lang:LauncherStrings.LoadingMessage}"
					          VerticalAlignment="Center"
					          FontSize="14"
					          Foreground="{DynamicResource TextFillColorPrimaryBrush}" />
				</StackPanel>
			</Border>
		</Grid>
	</Grid>
</Window>
